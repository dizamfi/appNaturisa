import 'package:appnaturisa/providers/navigation_provider.dart';
import 'package:appnaturisa/providers/ps_josefina_provider.dart';
import 'package:appnaturisa/providers/user_provider.dart';
import 'package:appnaturisa/screens/camaroneras_screen.dart';
import 'package:appnaturisa/screens/inicio_camaroneras_screens.dart';
import 'package:appnaturisa/screens/inicio_screen.dart';
import 'package:appnaturisa/screens/inicio_sesion_screens.dart';
import 'package:appnaturisa/screens/josefina/aireacion_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc101_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc102_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc103_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc104_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc106_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc107_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc108_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc111_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc113_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc114_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc115_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc116_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc117_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/pc20_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps01_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps02_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps03_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps04_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps05_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps06_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps07_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps08_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps09_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps10_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps11_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps13_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps14_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps15_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps16_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps17_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps18_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps19_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps21_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps22_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps23_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps24_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps25_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps26_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps27_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps28_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps29_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps30_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps31_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps32_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps33_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps34_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps35_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps36_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps37_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps38_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps39_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps40_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps41_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps42_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps43_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps44_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps45_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps46_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps47B_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps47_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps48_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps49_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps50_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps51_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps52_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps53_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps54_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps55_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps56_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps57_josefina_screen.dart';
import 'package:appnaturisa/screens/josefina/ps/ps58_josefina_screen.dart';
import 'package:appnaturisa/services/storage_service.dart';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:intl/date_symbol_data_local.dart';

import 'package:intl/intl.dart';
import 'package:provider/provider.dart'; // Si necesitas manejo de fechas

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await StorageService.init();
  SystemChrome.setPreferredOrientations(
      [DeviceOrientation.portraitUp, DeviceOrientation.portraitDown]);

  await initializeDateFormatting('es_ES', null);

  SystemChrome.setSystemUIOverlayStyle(
    const SystemUiOverlayStyle(
      statusBarColor: Colors.transparent,
      statusBarIconBrightness: Brightness.dark,
    ),
  );

  runApp(const MyApp());
}

class MyApp extends StatefulWidget {
  const MyApp({super.key});

  @override
  State<MyApp> createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> with WidgetsBindingObserver {
  final GlobalKey<NavigatorState> navigatorKey = GlobalKey<NavigatorState>();
  final GlobalKey<ScaffoldMessengerState> messengerKey =
      GlobalKey<ScaffoldMessengerState>();

  @override
  void initState() {
    super.initState();
    // Agregar el observador del ciclo de vida
    WidgetsBinding.instance.addObserver(this);
  }

  @override
  void dispose() {
    // Eliminar el observador del ciclo de vida
    WidgetsBinding.instance.removeObserver(this);
    super.dispose();
  }

  String _obtenerFechaHoraActual() {
    // Capturar la fecha y hora actual
    DateTime ahora = DateTime.now();

    // Formatear la fecha y hora
    String formato = DateFormat('dd/MM/yyyy, hh:mm a').format(ahora);

    print(formato);

    return formato;
  }

  @override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    final user = StorageService.prefs.getString('user');
    if (state == AppLifecycleState.paused) {
      UserProvider.updateUser(user!,
          {"estado": "desconectado", "ultconexion": _obtenerFechaHoraActual()});
    } else if (state == AppLifecycleState.resumed) {
      UserProvider.updateUser(user!, {"estado": "conectado"});
    }
  }

  @override
  Widget build(BuildContext context) {
    return MultiProvider(
      providers: [
        ChangeNotifierProvider(create: (context) => PiscinasJosefinaProvider()),
        ChangeNotifierProvider(create: (context) => UserProvider()),
        ChangeNotifierProvider(create: (_) => NavigationProvider()),
      ],
      child: MaterialApp(
        theme: ThemeData(
          scaffoldBackgroundColor: Colors.white,
        ),
        debugShowCheckedModeBanner: false,
        builder: (BuildContext context, Widget? child) {
          return MediaQuery(
            data: MediaQuery.of(context)
                .copyWith(textScaler: const TextScaler.linear(1.0)),
            child: child!,
          );
        },
        initialRoute: 'inicio_sesion_screen',
        navigatorKey: navigatorKey,
        scaffoldMessengerKey: messengerKey,
        routes: {
          'inicio_sesion_screen': ((_) => const InicioSesionScreen()),
          'aireacion_josefina_screen': ((_) => const AireacionJosefinaScreen()),
          'inicio_screen': ((_) => const InicioScreen()),
          'pc20_josefina_screen': ((_) => const PC20JosefinaScreen()),
          'pc101_josefina_screen': ((_) => const PC101JosefinaScreen()),
          'pc102_josefina_screen': ((_) => const PC102JosefinaScreen()),
          'pc103_josefina_screen': ((_) => const PC103JosefinaScreen()),
          'pc104_josefina_screen': ((_) => const PC104JosefinaScreen()),
          'pc106_josefina_screen': ((_) => const PC106JosefinaScreen()),
          'pc107_josefina_screen': ((_) => const PC107JosefinaScreen()),
          'pc108_josefina_screen': ((_) => const PC108JosefinaScreen()),
          'pc111_josefina_screen': ((_) => const PC111JosefinaScreen()),
          'pc113_josefina_screen': ((_) => const PC113JosefinaScreen()),
          'pc114_josefina_screen': ((_) => const PC114JosefinaScreen()),
          'pc115_josefina_screen': ((_) => const PC115JosefinaScreen()),
          'pc116_josefina_screen': ((_) => const PC116JosefinaScreen()),
          'pc117_josefina_screen': ((_) => const PC117JosefinaScreen()),
          'ps01_josefina_screen': ((_) => const PS01JosefinaScreen()),
          'ps02_josefina_screen': ((_) => const PS02JosefinaScreen()),
          'ps03_josefina_screen': ((_) => const PS03JosefinaScreen()),
          'ps04_josefina_screen': ((_) => const PS04JosefinaScreen()),
          'ps05_josefina_screen': ((_) => const PS05JosefinaScreen()),
          'ps06_josefina_screen': ((_) => const PS06JosefinaScreen()),
          'ps07_josefina_screen': ((_) => const PS07JosefinaScreen()),
          'ps08_josefina_screen': ((_) => const PS08JosefinaScreen()),
          'ps09_josefina_screen': ((_) => const PS09JosefinaScreen()),
          'ps10_josefina_screen': ((_) => const PS10JosefinaScreen()),
          'ps11_josefina_screen': ((_) => const PS11JosefinaScreen()),
          'ps13_josefina_screen': ((_) => const PS13JosefinaScreen()),
          'ps14_josefina_screen': ((_) => const PS14JosefinaScreen()),
          'ps15_josefina_screen': ((_) => const PS15JosefinaScreen()),
          'ps16_josefina_screen': ((_) => const PS16JosefinaScreen()),
          'ps17_josefina_screen': ((_) => const PS17JosefinaScreen()),
          'ps18_josefina_screen': ((_) => const PS18JosefinaScreen()),
          'ps19_josefina_screen': ((_) => const PS19JosefinaScreen()),
          'ps21_josefina_screen': ((_) => const PS21JosefinaScreen()),
          'ps22_josefina_screen': ((_) => const PS22JosefinaScreen()),
          'ps23_josefina_screen': ((_) => const PS23JosefinaScreen()),
          'ps24_josefina_screen': ((_) => const PS24JosefinaScreen()),
          'ps25_josefina_screen': ((_) => const PS25JosefinaScreen()),
          'ps26_josefina_screen': ((_) => const PS26JosefinaScreen()),
          'ps27_josefina_screen': ((_) => const PS27JosefinaScreen()),
          'ps28_josefina_screen': ((_) => const PS28JosefinaScreen()),
          'ps29_josefina_screen': ((_) => const PS29JosefinaScreen()),
          'ps30_josefina_screen': ((_) => const PS30JosefinaScreen()),
          'ps31_josefina_screen': ((_) => const PS31JosefinaScreen()),
          'ps32_josefina_screen': ((_) => const PS32JosefinaScreen()),
          'ps33_josefina_screen': ((_) => const PS33JosefinaScreen()),
          'ps34_josefina_screen': ((_) => const PS34JosefinaScreen()),
          'ps35_josefina_screen': ((_) => const PS35JosefinaScreen()),
          'ps36_josefina_screen': ((_) => const PS36JosefinaScreen()),
          'ps37_josefina_screen': ((_) => const PS37JosefinaScreen()),
          'ps38_josefina_screen': ((_) => const PS38JosefinaScreen()),
          'ps39_josefina_screen': ((_) => const PS39JosefinaScreen()),
          'ps40_josefina_screen': ((_) => const PS40JosefinaScreen()),
          'ps41_josefina_screen': ((_) => const PS41JosefinaScreen()),
          'ps42_josefina_screen': ((_) => const PS42JosefinaScreen()),
          'ps43_josefina_screen': ((_) => const PS43JosefinaScreen()),
          'ps44_josefina_screen': ((_) => const PS44JosefinaScreen()),
          'ps45_josefina_screen': ((_) => const PS45JosefinaScreen()),
          'ps46_josefina_screen': ((_) => const PS46JosefinaScreen()),
          'ps47_josefina_screen': ((_) => const PS47JosefinaScreen()),
          'ps47B_josefina_screen': ((_) => const PS47BJosefinaScreen()),
          'ps48_josefina_screen': ((_) => const PS48JosefinaScreen()),
          'ps49_josefina_screen': ((_) => const PS49JosefinaScreen()),
          'ps50_josefina_screen': ((_) => const PS50JosefinaScreen()),
          'ps51_josefina_screen': ((_) => const PS51JosefinaScreen()),
          'ps52_josefina_screen': ((_) => const PS52JosefinaScreen()),
          'ps53_josefina_screen': ((_) => const PS53JosefinaScreen()),
          'ps54_josefina_screen': ((_) => const PS54JosefinaScreen()),
          'ps55_josefina_screen': ((_) => const PS55JosefinaScreen()),
          'ps56_josefina_screen': ((_) => const PS56JosefinaScreen()),
          'ps57_josefina_screen': ((_) => const PS57JosefinaScreen()),
          'ps58_josefina_screen': ((_) => const PS58JosefinaScreen()),
          // Agrega tus demás rutas aquí...

          'inicio_camaroneras': ((_) => const InicioCamaronerasScreen()),
        },
      ),
    );
  }
}
